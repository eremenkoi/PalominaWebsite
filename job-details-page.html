<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PaloPay - Job Details</title>
  <style>
    /* Global Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
    }
    header.global-header {
      text-align: center;
      margin-bottom: 10px;
    }
    header.global-header img {
      max-width: 200px;
      display: block;
      margin: 0 auto;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #333;
      text-decoration: none;
      padding: 5px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    .back-link:hover {
      background: #f0f0f0;
    }
    h1, h2, h3 {
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .error {
      color: #e53935;
      padding: 20px;
      background: #ffebee;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    /* Job Header */
    .job-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .job-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .job-title h1 {
      margin: 0;
      font-size: 24px;
    }
    .job-number {
      font-size: 16px;
      color: #666;
      font-weight: normal;
    }
    .job-dates {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    .date-item {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      flex: 1;
    }
    .date-item h3 {
      margin: 0 0 5px 0;
      font-size: 14px;
      color: #666;
    }
    .date-item p {
      margin: 0;
      font-size: 16px;
      font-weight: bold;
    }

    /* Job Summary Dashboard */
    .job-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .dashboard-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .dashboard-card h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
    }
    .dashboard-value {
      font-size: 24px;
      font-weight: bold;
      color: #2196f3;
      margin: 0;
    }
    .dashboard-subtext {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-right: 5px;
    }
    .tab.active {
      border-color: #2196f3;
      font-weight: bold;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f5f5f5;
      font-weight: bold;
      cursor: pointer;
      position: relative;
    }
    th:hover {
      background-color: #e0e0e0;
    }
    th::after {
      content: "‚áÖ";
      position: absolute;
      right: 8px;
      color: #999;
      font-size: 12px;
    }
    th.sort-asc::after {
      content: "‚Üë";
      color: #333;
    }
    th.sort-desc::after {
      content: "‚Üì";
      color: #333;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .group-header {
      background: #e3f2fd;
      font-weight: bold;
    }

    /* Button Styles */
    .button-group {
      margin-bottom: 15px;
    }
    button {
      padding: 8px 12px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      cursor: pointer;
    }
    button:hover {
      background: #f0f0f0;
    }
    button.active {
      background: #e3f2fd;
      border-color: #2196f3;
      font-weight: bold;
    }

    /* Badges and Tags */
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    .badge-freelance {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .badge-agency {
      background: #e3f2fd;
      color: #1565c0;
    }
    .badge-union {
      background: #fff8e1;
      color: #f57f17;
    }

    /* Document Link Styles */
    .doc-link {
      display: inline-flex;
      align-items: center;
      color: #2196f3;
      text-decoration: none;
    }
    .doc-link:hover {
      text-decoration: underline;
    }
    .doc-link::before {
      content: "üìÑ";
      margin-right: 5px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .job-dashboard {
        grid-template-columns: repeat(2, 1fr);
      }
      .date-item h3 {
        font-size: 12px;
      }
      .date-item p {
        font-size: 14px;
      }
    }
    @media (max-width: 480px) {
      .job-dashboard {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Global Header -->
  <header class="global-header">
    <img src="sunday-gravy-logo.png" alt="Sunday Gravy Logo">
  </header>

  <div class="container">
    <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>

    <div id="loading">Loading job details...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="jobDetails" style="display: none;">

      <!-- Job Header and Summary -->
      <div class="job-header">
        <div class="job-title">
          <h1 id="jobName">Job Name</h1>
          <span id="jobNumber" class="job-number">Job #: AU41-XXXX</span>
        </div>

        <div class="job-dates">
          <div class="date-item">
            <h3>First On Air</h3>
            <p id="firstOnAir">DD/MM/YYYY</p>
          </div>
          <div class="date-item">
            <h3>Contract Ends</h3>
            <p id="contractEnds">DD/MM/YYYY</p>
          </div>
          <div class="date-item">
            <h3>Contract Term</h3>
            <p id="contractTerm">XX Months</p>
          </div>
        </div>
      </div>

      <!-- Dashboard Summary Cards -->
      <div class="job-dashboard">
        <div class="dashboard-card">
          <h3>Total Talent</h3>
          <p id="totalTalent" class="dashboard-value">0</p>
          <p class="dashboard-subtext">People on this job</p>
        </div>
        <div class="dashboard-card">
          <h3>Total Contract Value</h3>
          <p id="totalContractValue" class="dashboard-value">$0</p>
          <p class="dashboard-subtext">Combined talent fees</p>
        </div>
        <div class="dashboard-card">
          <h3>Talent Types</h3>
          <p id="talentTypes" class="dashboard-value">-</p>
          <p class="dashboard-subtext">Breakdown</p>
        </div>
        <div class="dashboard-card">
          <h3>Status</h3>
          <p id="jobStatus" class="dashboard-value">Active</p>
          <p id="daysRemaining" class="dashboard-subtext">Days remaining</p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" data-tab="talent">Talent</div>
        <div class="tab" data-tab="documents">Documents</div>
        <div class="tab" data-tab="details">Job Details</div>
      </div>

      <!-- Talent Tab -->
      <div id="talentTab" class="tab-content active">
        <!-- Table Controls -->
        <div class="button-group">
          <button id="groupByNone" class="active">No Grouping</button>
          <button id="groupByType">Group by Type</button>
          <button id="groupByAgency">Group by Agency</button>
        </div>

        <!-- Talent Table -->
        <div class="table-container">
          <table id="talentTable">
            <thead>
              <tr>
                <th data-sort="name">Talent Name</th>
                <th data-sort="agency">Talent Agency</th>
                <th data-sort="type">Type</th>
                <th data-sort="role">Role</th>
                <th data-sort="fee">Contract Fee</th>
                <th>Deal Memo</th>
                <th>Contract / DOR</th>
              </tr>
            </thead>
            <tbody id="talentTableBody">
              <!-- Talent rows will be added here dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Documents Tab -->
      <div id="documentsTab" class="tab-content">
        <h2>Job Documents</h2>
        <div id="documentsContent">
          <!-- Documents will be added here dynamically -->
        </div>
      </div>

      <!-- Details Tab -->
      <div id="detailsTab" class="tab-content">
        <h2>Job Details</h2>
        <div class="table-container">
          <table>
            <tbody id="jobDetailsContent">
              <!-- Job details will be added here dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

// Add this script to your job-details.html page
// Replace the entire script section with this version

<script>
  // Get job number from URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const jobNumber = urlParams.get('jobNumber');
  let jobData = null;
  let talentData = [];

  // DOM elements
  const loadingEl = document.getElementById('loading');
  const errorEl = document.getElementById('error');
  const jobDetailsEl = document.getElementById('jobDetails');

  // Check if we have job data in sessionStorage (from timeline click)
  let sessionJobData = null;
  try {
    const storedData = sessionStorage.getItem('currentJobData');
    if (storedData) {
      sessionJobData = JSON.parse(storedData);
    }
  } catch (e) {
    console.error("Error reading session storage:", e);
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Debug info - log URL parameters
    console.log("URL parameters:", Object.fromEntries(urlParams));
    console.log("Job number from URL:", jobNumber);
    console.log("Session data:", sessionJobData);

    if (!jobNumber) {
      showError("No job number provided. Please select a job from the dashboard.");
      return;
    }

    // Load job data
    loadJobDetails();

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove active class from all tabs and content
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        // Add active class to clicked tab and corresponding content
        this.classList.add('active');
        document.getElementById(this.getAttribute('data-tab') + 'Tab').classList.add('active');
      });
    });

    // Table sorting
    document.querySelectorAll('th[data-sort]').forEach(header => {
      header.addEventListener('click', function() {
        const sortField = this.getAttribute('data-sort');
        sortTable(sortField);
      });
    });

    // Grouping buttons
    document.getElementById('groupByNone').addEventListener('click', function() {
      document.querySelectorAll('.button-group button').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      renderTalentTable(talentData);
    });

    document.getElementById('groupByType').addEventListener('click', function() {
      document.querySelectorAll('.button-group button').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      renderTalentTable(talentData, 'type');
    });

    document.getElementById('groupByAgency').addEventListener('click', function() {
      document.querySelectorAll('.button-group button').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      renderTalentTable(talentData, 'agency');
    });
  });

  // Load job details from API
  async function loadJobDetails() {
    try {
      // First, use already fetched data from session if available
      if (sessionJobData && sessionJobData.jobNumber === jobNumber) {
        // Use basic info from session storage
        updateJobHeader(sessionJobData);
      }

      // API call to get job details
      const response = await fetch(`/.netlify/functions/fetchJobTracker?jobNumber=${encodeURIComponent(jobNumber)}`);
      console.log("API call made to:", `/.netlify/functions/fetchJobTracker?jobNumber=${encodeURIComponent(jobNumber)}`);

      const data = await response.json();
      console.log("API response:", data);

      if (!response.ok || data.error) {
        throw new Error(data.error || 'Failed to load job details');
      }

      // Store job data
      jobData = data.job;
      talentData = data.talent || [];

      console.log("Job data:", jobData);
      console.log("Talent data:", talentData);

      // Update the UI
      updateJobHeader(jobData);
      updateJobDashboard(jobData, talentData);
      renderTalentTable(talentData);
      renderJobDetails(jobData);
      renderDocuments(jobData, talentData);

      // Show job details container
      loadingEl.style.display = 'none';
      jobDetailsEl.style.display = 'block';

    } catch (error) {
      console.error("Error loading job details:", error);

      // If we have session data, show partial information
      if (sessionJobData && sessionJobData.jobNumber === jobNumber) {
        // Create dummy data based on session storage
        jobData = {
          ...sessionJobData,
          contractTerm: extractTermFromDates(sessionJobData.firstOnAir, sessionJobData.contractEnd)
        };

        // Show limited view with warning
        loadingEl.style.display = 'none';
        jobDetailsEl.style.display = 'block';

        showError(`Could not load complete job details: ${error.message}. Showing limited information.`);
      } else {
        // Show error if no session data available
        showError(`Error loading job details: ${error.message}`);
      }
    }
  }

  // Extract contract term from dates
  function extractTermFromDates(startDate, endDate) {
    try {
      // Parse dates if they're strings
      const start = typeof startDate === 'string' ? new Date(startDate.split('/').reverse().join('-')) : startDate;
      const end = typeof endDate === 'string' ? new Date(endDate.split('/').reverse().join('-')) : endDate;

      if (isNaN(start.getTime()) || isNaN(end.getTime())) {
        return "N/A";
      }

      // Calculate difference in months
      const monthsDiff = (end.getFullYear() - start.getFullYear()) * 12 +
                         (end.getMonth() - start.getMonth());

      return `${monthsDiff} Months`;
    } catch (e) {
      console.error("Error calculating contract term:", e);
      return "N/A";
    }
  }

  // Update job header information
  function updateJobHeader(job) {
    document.getElementById('jobName').textContent = job.jobName || 'Unnamed Job';
    document.getElementById('jobNumber').textContent = `Job #: ${job.jobNumber || 'Unknown'}`;
    document.getElementById('firstOnAir').textContent = job.firstOnAir || 'N/A';
    document.getElementById('contractEnds').textContent = job.contractEnd || job.contractEnds || 'N/A';
    document.getElementById('contractTerm').textContent = job.contractTerm || 'N/A';
  }

  // Update job dashboard summary
  function updateJobDashboard(job, talent) {
    // Total talent count
    document.getElementById('totalTalent').textContent = talent.length;

    // Calculate total contract value
    let totalValue = 0;
    talent.forEach(person => {
      const fee = parseFloat(person.contractFee || '0');
      if (!isNaN(fee)) {
        totalValue += fee;
      }
    });
    document.getElementById('totalContractValue').textContent = formatCurrency(totalValue);

    // Count talent types
    const typeCount = {};
    talent.forEach(person => {
      const type = person.type || 'Unknown';
      typeCount[type] = (typeCount[type] || 0) + 1;
    });

    let typeText = '';
    if (Object.keys(typeCount).length > 0) {
      const mainType = Object.keys(typeCount).reduce((a, b) =>
        typeCount[a] > typeCount[b] ? a : b);
      typeText = `${mainType} (${typeCount[mainType]})`;
    } else {
      typeText = 'N/A';
    }
    document.getElementById('talentTypes').textContent = typeText;

    // Calculate job status
    const today = new Date();
    const endDate = parseDate(job.contractEnd || job.contractEnds);
    const startDate = parseDate(job.firstOnAir);

    let status, daysText;
    if (!startDate || !endDate) {
      status = 'Unknown';
      daysText = '';
    } else if (today < startDate) {
      status = 'Upcoming';
      const daysToStart = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));
      daysText = `Starts in ${daysToStart} days`;
    } else if (today > endDate) {
      status = 'Expired';
      const daysAgo = Math.ceil((today - endDate) / (1000 * 60 * 60 * 24));
      daysText = `Expired ${daysAgo} days ago`;
    } else {
      status = 'Active';
      const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
      daysText = `${daysLeft} days remaining`;
    }

    document.getElementById('jobStatus').textContent = status;
    document.getElementById('daysRemaining').textContent = daysText;
  }

  // Render talent table
  function renderTalentTable(talent, groupBy = null) {
    const tableBody = document.getElementById('talentTableBody');
    tableBody.innerHTML = '';

    if (!talent || talent.length === 0) {
      const row = document.createElement('tr');
      row.innerHTML = `<td colspan="7">No talent records found for this job.</td>`;
      tableBody.appendChild(row);
      return;
    }

    // Clone the data before sorting/grouping
    const talentList = [...talent];

    // Sort by name by default
    talentList.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

    if (groupBy) {
      // Group the data
      const groups = {};
      talentList.forEach(person => {
        const groupValue = person[groupBy] || 'Unknown';
        if (!groups[groupValue]) {
          groups[groupValue] = [];
        }
        groups[groupValue].push(person);
      });

      // Render each group
      Object.keys(groups).sort().forEach(groupValue => {
        // Add group header
        const groupRow = document.createElement('tr');
        groupRow.className = 'group-header';
        groupRow.innerHTML = `<td colspan="7">${groupValue} (${groups[groupValue].length})</td>`;
        tableBody.appendChild(groupRow);

        // Add group items
        groups[groupValue].forEach(person => {
          tableBody.appendChild(createTalentRow(person));
        });
      });
    } else {
      // Render without grouping
      talentList.forEach(person => {
        tableBody.appendChild(createTalentRow(person));
      });
    }
  }

  // Create a talent table row
  function createTalentRow(person) {
    const row = document.createElement('tr');

    // Get type badge class
    let typeBadgeClass = 'badge-freelance';
    if ((person.type || '').toLowerCase().includes('agency')) {
      typeBadgeClass = 'badge-agency';
    } else if ((person.type || '').toLowerCase().includes('union')) {
      typeBadgeClass = 'badge-union';
    }

    row.innerHTML = `
      <td>${person.name || 'Unknown'}</td>
      <td>${person.agency || 'N/A'}</td>
      <td><span class="badge ${typeBadgeClass}">${person.type || 'Unknown'}</span></td>
      <td>${person.role || 'N/A'}</td>
      <td>${formatCurrency(person.contractFee) || 'N/A'}</td>
      <td>${person.dealMemo ? `<a href="${person.dealMemo}" class="doc-link" target="_blank">Deal Memo</a>` : 'N/A'}</td>
      <td>${person.contract ? `<a href="${person.contract}" class="doc-link" target="_blank">Contract</a>` : 'N/A'}</td>
    `;

    return row;
  }

  // Render job details
  function renderJobDetails(job) {
    const detailsContent = document.getElementById('jobDetailsContent');
    detailsContent.innerHTML = '';

    // Define the fields to show
    const fieldsToShow = [
      { label: 'Job Number', field: 'jobNumber' },
      { label: 'Job Name', field: 'jobName' },
      { label: 'Client', field: 'client' },
      { label: 'Campaign', field: 'campaign' },
      { label: 'Territory', field: 'territory' },
      { label: 'First On Air', field: 'firstOnAir' },
      { label: 'Contract End', field: 'contractEnd' },
      { label: 'Contract Term', field: 'contractTerm' },
      { label: 'Usage Rights', field: 'usageRights' },
      { label: 'Job Description', field: 'jobDescription' }
    ];

    fieldsToShow.forEach(field => {
      if (job[field.field] !== undefined && job[field.field] !== null) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <th style="width: 30%;">${field.label}</th>
          <td>${job[field.field]}</td>
        `;
        detailsContent.appendChild(row);
      }
    });

    // If no fields were added
    if (detailsContent.children.length === 0) {
      const row = document.createElement('tr');
      row.innerHTML = `<td colspan="2">No additional details available.</td>`;
      detailsContent.appendChild(row);
    }
  }

  // Render documents
  function renderDocuments(job, talent) {
    const docsContent = document.getElementById('documentsContent');
    docsContent.innerHTML = '';

    let hasDocuments = false;

    // Job documents
    if (job.documents && job.documents.length > 0) {
      hasDocuments = true;
      const jobDocsSection = document.createElement('div');
      jobDocsSection.innerHTML = `<h3>Job Documents</h3>`;

      const docsList = document.createElement('ul');
      job.documents.forEach(doc => {
        const item = document.createElement('li');
        item.innerHTML = `<a href="${doc.url}" class="doc-link" target="_blank">${doc.name || 'Document'}</a>`;
        docsList.appendChild(item);
      });

      jobDocsSection.appendChild(docsList);
      docsContent.appendChild(jobDocsSection);
    }

    // Talent documents
    const talentWithDocs = talent.filter(p => p.contract || p.dealMemo);
    if (talentWithDocs.length > 0) {
      hasDocuments = true;
      const talentDocsSection = document.createElement('div');
      talentDocsSection.innerHTML = `<h3>Talent Documents</h3>`;

      const docsList = document.createElement('ul');
      talentWithDocs.forEach(person => {
        if (person.contract) {
          const item = document.createElement('li');
          item.innerHTML = `<a href="${person.contract}" class="doc-link" target="_blank">${person.name} - Contract</a>`;
          docsList.appendChild(item);
        }

        if (person.dealMemo) {
          const item = document.createElement('li');
          item.innerHTML = `<a href="${person.dealMemo}" class="doc-link" target="_blank">${person.name} - Deal Memo</a>`;
          docsList.appendChild(item);
        }
      });

      talentDocsSection.appendChild(docsList);
      docsContent.appendChild(talentDocsSection);
    }

    // No documents message
    if (!hasDocuments) {
      docsContent.innerHTML = `<p>No documents available for this job.</p>`;
    }
  }

  // Sort table by column
  function sortTable(field) {
    // Get the header element
    const header = document.querySelector(`th[data-sort="${field}"]`);

    // Determine sort direction
    const currentDir = header.classList.contains('sort-asc') ? 'desc' :
                      (header.classList.contains('sort-desc') ? 'none' : 'asc');

    // Remove sorting classes from all headers
    document.querySelectorAll('th[data-sort]').forEach(el => {
      el.classList.remove('sort-asc', 'sort-desc');
    });

    // Sort the data
    if (currentDir === 'asc') {
      header.classList.add('sort-asc');
      talentData.sort((a, b) => {
        // Handle numeric sorting for fees
        if (field === 'fee') {
          return parseFloat(a.contractFee || 0) - parseFloat(b.contractFee || 0);
        }
        return (a[field] || '').localeCompare(b[field] || '');
      });
    } else if (currentDir === 'desc') {
      header.classList.add('sort-desc');
      talentData.sort((a, b) => {
        if (field === 'fee') {
          return parseFloat(b.contractFee || 0) - parseFloat(a.contractFee || 0);
        }
        return (b[field] || '').localeCompare(a[field] || '');
      });
    } else {
      // Default sort by name if sorting is removed
      talentData.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
    }

    // Get current grouping method
    let groupBy = null;
    if (document.getElementById('groupByType').classList.contains('active')) {
      groupBy = 'type';
    } else if (document.getElementById('groupByAgency').classList.contains('active')) {
      groupBy = 'agency';
    }

    // Re-render the table
    renderTalentTable(talentData, groupBy);
  }

  // Helper function to format currency
  function formatCurrency(value) {
    if (value === undefined || value === null) return '';

    const numValue = parseFloat(value);
    if (isNaN(numValue)) return '';

    return '$' + numValue.toLocaleString('en-US', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  // Helper function to parse dates
  function parseDate(dateStr) {
    if (!dateStr) return null;

    try {
      // Australian format DD/MM/YYYY
      if (dateStr.includes('/')) {
        const parts = dateStr.split('/');
        if (parts.length === 3) {
          return new Date(parts[2], parts[1] - 1, parts[0]);
        }
      }

      // Fallback
      return new Date(dateStr);
    } catch (e) {
      console.error("Date parsing error:", e);
      return null;
    }
  }

  // Show error message
  function showError(message) {
    loadingEl.style.display = 'none';
    errorEl.style.display = 'block';
    errorEl.textContent = message;
  }
</script>
</body>
</html>